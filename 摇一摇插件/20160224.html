<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="robots" content="noindex">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telphone=no">
<title>瓷肌女神节  壕礼送给挚爱的她！</title>
<link rel="stylesheet" href="../public/images/weixinact/20150914/base_c.css">
<link rel="stylesheet" href="../public/images/weixinact/20160224/20160224.css">
<style>
</style>
</head>
<body>
	<div class="loading_box" id="loading_box" style="z-index:3;">
		<div class="main">
			<div id="load_main">
				<div class="loading_info w100"> <span id="loading_bg"></span> <img src="/public/images/weixinact/20150914/loading_logo2.png" /> </div>
				<div class="loading_num">
					<div class="jdc" style="z-index:1;"> <span></span> <span class="sec"> </span><span class="thr"> </span><span class="four"> </span><span class="five"> </span> </div>
					<br/> 加载中...
					<span id="total" style="color:#fff;">0%</span> 
				</div>
			</div>
		</div>
	</div>	
	<div class="main" id="inf" style="z-index:2;">
		<div class="main_body pa bg" id="main_body">
			<div class="part1" >
				<img class="flower pa" loadimg="/public/images/weixinact/20160224/5.png" alt=""/>
				<img class="logo pa" loadimg="/public/images/weixinact/20160224/logo.png" alt="" />
				<span class="p1-t pa">
					<b><img loadimg="/public/images/weixinact/20160224/1.png" alt="" /></b>
				</span>
				<span class="p1-l pa">
					<img loadimg="/public/images/weixinact/20160224/2.png" alt="" />
				</span>
				<span class="p1-r-1 pa">
					<img loadimg="/public/images/weixinact/20160224/6.png" alt="" />
				</span>
				<span class="p1-r-2 pa">
					<img loadimg="/public/images/weixinact/20160224/7.png" alt="" />
				</span>
				<span class="p1-r-3 pa">
					<img loadimg="/public/images/weixinact/20160224/8.png" alt="" />
				</span>
				<span class="p1-r-4 pa">
					<b><img loadimg="/public/images/weixinact/20160224/9.png" alt="" /></b>
				</span>
				<span class="p1-r-5 pa">
					<b><img loadimg="/public/images/weixinact/20160224/p1-font.png" alt="" /></b>
				</span>
				<span class="cloud_1 pa">
					<img loadimg="/public/images/weixinact/20160224/4.png" alt="" />
				</span>
				<span class="cloud_2 pa">
					<img loadimg="/public/images/weixinact/20160224/3.png" alt="" />
				</span>
			</div>
			<div class="part2" style="display: none;">
				<img class="flower pa" loadimg="/public/images/weixinact/20160224/14.png" alt=""/>
				<div class="p2-cir pa">
					<img loadimg="/public/images/weixinact/20160224/15.png" alt="" />
					<span class="p2-hm pa">
						<b><img loadimg="/public/images/weixinact/20160224/16.png" alt="" /></b>
					</span>
				</div>				
				<span class="p2-yy pa">
					<b><img loadimg="/public/images/weixinact/20160224/11.png" alt="" /></b>
				</span>
				<span class="p2-j pa">
					<img loadimg="/public/images/weixinact/20160224/12.png" alt="" />
				</span>
				<span class="p2-yyy pa">
					<b><img loadimg="/public/images/weixinact/20160224/10.png" alt="" /></b>
				</span>
				<span class="cloud_1 pa">
					<img loadimg="/public/images/weixinact/20160224/4.png" alt="" />
				</span>
				<div class="cloud_2 pa">
					<img loadimg="/public/images/weixinact/20160224/3.png" alt="" />
				</div>
				<span class="cloud_3 pa">
					<img loadimg="/public/images/weixinact/20160224/13.png" alt="" />
				</span>
				<a class="p2-b pa" href="javascript:;">活动规则</a>
			</div>
			<!--遮罩-->
			<div id="pop_mask" ></div>
			<!--活动规则-->
			<div class="fix_pop" id="pop_1" style="display: none;">
				<div class="pop_1 pr">
					<img loadimg="/public/images/weixinact/20160224/popUp_1.png" alt="" />
					<div class="close close_1">X</div>
					<div class="pop_content">
						<p class="p1">活动规则</p>
						<p class="p2"><i>1</i>每个ip每天可抽奖3次，分享到朋友圈可多抽奖一次</p>
						<p class="p2"><i>2</i>每个ip最多只有一次中奖机会</p>
						<p class="p2"><i>3</i>中奖用户请确保个人信息填写正确无误</p>
						<p class="p2"><i>4</i>一切中奖信息以瓷肌后台为准</p>
						<p class="p2"><i>5</i>活动不限时间，奖品送完即止</p>
						<p class="p2"><i>6</i>所有奖品，将于活动结束后一周内寄出</p>
						<p class="p2"><i>7</i>本活动最终解释权归瓷肌官方微信所有</p>
					</div>
					
				</div>
			</div>
			<!--不中-->
			<div class="fix_pop" id="pop_2"  style="display: none;">
				<div class="pop_1 pr">
					<img loadimg="/public/images/weixinact/20160224/popUp_1.png" alt="" />
					<div class="close close_1">X</div>					
					<div class="pop_content">
						<p class="p3">亲，你的姿势不对，再来一遍！<br/>每天有三次机会~</p>
					</div>
				</div>
			</div>
			<!--机会用完-->
			<div class="fix_pop" id="pop_3">
				<div class="pop_1 pr">
					<img loadimg="/public/images/weixinact/20160224/popUp_1.png" alt="" />
					<div class="close close_1">X</div>					
					<div class="pop_content">
						<p class="p3">今天的三次机会已用完<br/>分享到朋友圈可再抽奖一次！</p>
						<a href="javascript:;" class="share">
							<img loadimg="/public/images/weixinact/20160224/17.png" alt="" />
						</a>
					</div>
				</div>
			</div>
			<!--中奖-->
			<div class="fix_pop" id="pop_4" style="display: none;">
				<div class="pop_2 pr">
					<div class="close close_2">X</div>
					<div class="prize-form">
						<form action="" method="post">
		                    <div class="line"></div>
		                    <p class="p4">恭喜你，中奖了<br/>请准确填写以下获奖信息</p>
		                    <div class="bonusPic" id="result">
		                    	<img loadimg="" alt="" />
		                    </div>
		                    <div class="form-item">
		                        <label>姓名</label><input type="text" name="username" value="" />
		                    </div>
		                    <div class="form-item">
		                        <label>电话</label><input type="text" name="phone" value="" />
		                    </div>
		                    <div class="form-item">
		                        <label>地址</label><input type="text" name="address" value=""/>
		                    </div>
		                    <a class="btn-submit" href="javascript:;">
		                    	<img loadimg="/public/images/weixinact/20160224/18.png" alt="" />
		                    </a>
		                </form>
	                </div>
				</div>
			</div>
			<div class="sharebox">
				<span><img loadimg="/public/images/weixinact/20160224/share_arrow.png" alt=""></span>			
			</div>
			<span id="musicControl">
		        <a id="mc_play" class="stop">
		            <audio id="musicfx" loop="loop" autoplay="autoplay">
		                <source src="/public/images/weixinact/20160224/music.mp3" type="audio/mpeg">
		            </audio>
		        </a>
		    </span>
		    <div id="bonus_owner" style="display: none;"></div>
		</div>		
    </div>
<script src="../public/script/jquery-2.1.3.min.js"></script>
<script src="/public/images/weixinact/20160224/shake.js"></script>   
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="/public/images/weixinact/20160224/musicPlay.js"></script> 
{literal}
<script type="text/javascript">
	//实时获奖滚动
	var MyMar=null;
	function horizonScroll(elem_id) {		
	    var $roll = $(elem_id),
		    $roll_scroll = $roll.children('ul');
		$roll_scroll.append("<li class='clone'></li>");
		$roll_scroll.find('li').eq(0).children().clone().appendTo('.clone');
		var $roll_left = $roll_scroll.find('li');
		var x = 0;
	    $roll_scroll.css({'width':'1000%'});
		$roll_left.css({'margin-right':'15px'});					
	    function roll_x(){ 
	        $roll.scrollLeft(++x);
			_margin = parseInt($roll_left.css('margin-right'));
	        if(x==$roll_left.width()+_margin) { x = 0 };
		};
		MyMar=setInterval(roll_x,20); 			
	};
	$(function(){
		//加载效果
		var _ = function(id) {
	        var objId = document.getElementById(id);
	        return (objId);
	    }
	    var n = 1,
	        totalimg,
	        loadEachimg,
	        imgs = document.getElementById("inf").getElementsByTagName("img");
	    for (var i = 0; i < imgs.length; i++) {
	        var imgsloadimg = imgs[i].getAttribute("loadimg"),
	            imgNum = (1 / imgs.length).toFixed(2);
	        imgs[i].setAttribute("src", imgsloadimg);
	        imgs[i].onload = function() {
	            var loadEach = Math.round(i * imgs.length * 100);
	                totalimg = loadEach;
	            loadEachimg = loadEach;
	            this.removeAttribute("loadimg");
	            loadEachP();
	            if (totalimg >= 95 && totalimg <= 100 || totalimg >= 100) {
	                _("total").innerHTML = "100%";
	                loadAll();
	            }
	        }
	    }
	    var h = $(window).height();
	    function loadEachP() {
	        //每张图片加载后回调
	        _("total").innerHTML = " " + loadEachimg + "% ";
	        _("loading_bg").style.height = "" + loadEachimg + "% ";
	    }
	    function loadAll() {
	        //全部图片加载后回调
	        _("loading_bg").style.height = "100%";
	        _("loading_box").style.cssText = "transform:scale(0.8); opacity:0; -webkit-transition:1s all; transition:1s all;-webkit-transition-delay:1.8s;transition-delay:1.8s;";
	        _("main_body").style.cssText = "opacity:1;-webkit-transition-delay:2s;transition-delay:2s;";
	        $('#inf').height(h);
	        $('.part1').addClass('on');
	        ///music
	        $('#musicControl').show();
        	just_play();
			$('#mc_play').on('click',function(){
				play_music();
			});
	    }         
	    $('.p1-r-4').on('click',function(){
	    	$(this).parent().hide();
	    	$('.part1').removeClass('on');
	    	$('.part2').addClass('on').show();
	    	var myShakeEvent = new Shake({
		        threshold: 15
		    });	
		    myShakeEvent.start();	
		    window.addEventListener('shake', shakeEventDidOccur, false);
	    });
	    $('.p2-b').on('click',function(){
	    	$('#pop_1,#pop_mask').show();
	    });
	    $('.close').on('click',function(){
	    	$(this).parent().parent().hide();
	    	$('#pop_mask').hide();        	
	    });        
	    $('.share').on('click',function(){
	    	$('#pop_3,#pop_mask').hide();
	    	$('.sharebox').show();
	    });
	    $('.sharebox').on('click',function(){
	    	$(this).hide();
	    });
	    function shakeEventDidOccur () {
	    	//获奖变量，true为获奖，false--未获奖	  
	    	/*1.瓷肌限量泰迪梦幻套装一套
	    	 *2.刘若英亲笔签名海报一张
	    	 *3.净白无瑕五谷焕彩面膜
	    	 *4.矿物隔离精纯CC霜
	    	 *5.普罗旺斯天然薰衣草纯露
	    	 * */
	    	$.ajax({
                type: 'POST',
                url: '/WeixinGoddess/addFav',
                dataType: 'json',
                error: function(){
                    return false;
                },
                success:function(data){
                   if(data.prizenum==0){
                   		$('#pop_3,#pop_mask').show(); 
                   }else if(data.prizenum==7){
   		                $('#pop_2,#pop_mask').show(); 		
                   }else{
               			var result = $("#result");
	    				var _img=result.children('img');
						_img.attr('src','/public/images/weixinact/20160224/jiang_'+data.prizenum+'.png');
    					$('#pop_4,#pop_mask').show();
               		}  
                }
            });
	    }
	    //提交表单
        $(".btn-submit").on('click',function(){
            var username = $.trim($('input[name="username"]').val());
            var tel = $.trim($('input[name="phone"]').val());
            var address = $.trim($('input[name="address"]').val());
            if(username==''){
                alert('请填写您的姓名！');
                return false;
            }
            if(tel==''){				
            	alert('请填写您的电话！');
                return false;
            }        	
        	var reg=/^1[34578]\d{9}$/;
        	if(!(reg.test(tel))){
        		alert('请输入正确的手机号！');
        		return false;
        	}          
            if(address==''){
                alert('请填写您的地址！');
                return false;
            }
            $.ajax({
                url : '/WeixinGoddess/userMsg',
                data : {username:username,tel:tel,address:address},
                dataType : 'JSON',
                type : 'POST',
                error: function(d){
                	alert('提交错误');
                    return false;
                },
                success:function(d){
                	if(d.code==200){
	                    $('#pop_4,#pop_mask').hide()
	                    alert('信息提交成功！');
	                    return false;
	                }
                }                
            });            
            return false;
        });
       //获奖状态滚动
   		var oUl=$('<ul></ul>');      		
   		getOwner();
   		setInterval(function(){
			getOwner();
   		},120000); 
   		function getOwner(){
   			$.ajax({
	            url : '/WeixinGoddess/getPrizeMsg',
	            type : 'POST',
	            error: function(data){
	            	alert('连接错误');
	                return false;
	            },
	            success:function(data){
					var data = eval('(' + data + ')');	
					var len=0;
					$.each(data, function(i, item) {
						len++;
				    });
	            	if(len>0){	            		
	            		if($('#bonus_owner').find('li').length>0){
	            			$('#bonus_owner').find('ul').html("");
	            			clearInterval(MyMar);
	            		}                		
	            		var oLi=$('<li></li>');
	            		$.each(data, function(i, item) {
	            			var oSpan=$('<span></span>');
	            			oSpan.text(item.tel+'获得'+item.prizename);	            			
	            			oSpan.appendTo(oLi);
	            		});						
	            		oLi.appendTo(oUl);
	            		oUl.appendTo($('#bonus_owner'));
	            		$("#bonus_owner").show();
	            		horizonScroll('#bonus_owner');
	            	}   
	            }                
	        });   
   		}
	}) 
</script>
{/literal}
<script>
    wx.config({
        appId: '{$signPackage.appId}',
        timestamp: '{$signPackage.timestamp}',
        nonceStr: '{$signPackage.nonceStr}',
        signature: '{$signPackage.signature}',
        jsApiList: [
            'onMenuShareTimeline',
            'hideMenuItems',
            'onMenuShareAppMessage'
        ]
    });
    wx.ready(function () {
        wx.hideMenuItems({
            menuList: [
                'menuItem:share:qq'
            ],
            success: function (res) {
                //alert("菜单隐藏成功");
            },
            fail: function (res) {
                alert(JSON.stringify(res));
            }
        });
        wx.onMenuShareTimeline({
            title: '{$shareTitle}',
            link: '{$shareLink}',
            imgUrl: '{$shareImg}',
            trigger: function (res) {
            },
            success: function (res) {
                alert("成功分享到朋友圈，等待你的朋友来帮你砍价吧！");
                //window.location.href = '{$shareLink}';
                $.ajax({
	                url : '/WeixinGoddess/addChance',
	                dataType : 'JSON',
	                type : 'POST',
	                error: function(d){                	
	                    return false;
	                },
	                success:function(d){
	                	if(d.code==200){
		                    alert('分享成功');
		                }else if(code==1001){
		                	alert('今天已经添加过抽奖机会，请明天继续');
		                }
	                }                
	            });
            },
            cancel: function (res) {

            },
            fail: function (res) {
                alert(JSON.stringify(res));
            }
        });
        wx.onMenuShareAppMessage({
            title: '{$shareTitle}',
            link: '{$shareLink}',
            imgUrl: '{$shareImg}',
            desc:'',
            type: '', // 分享类型,music、video或link，不填默认为link
            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            trigger: function (res) {
            },
            success: function () {
                alert("成功分享给朋友，等待你的朋友来帮你砍价吧！");
                //window.location.href = '{$shareLink}';
                $.ajax({
	                url : '/WeixinGoddess/addChance',
	                dataType : 'JSON',
	                type : 'POST',
	                error: function(d){                	
	                    return false;
	                },
	                success:function(d){
	                	if(d.code==200){
		                    alert('分享成功');
		                }else if(code==1001){
		                	alert('今天已经添加过抽奖机会，请明天继续');
		                }
	                }                
	            });      
            },
            cancel: function () {
            }
        });
    });
    wx.error(function (res) {
        alert(res.errMsg);
    });
</script>
</body>
</html>